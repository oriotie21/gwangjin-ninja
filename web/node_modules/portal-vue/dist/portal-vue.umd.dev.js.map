{"version":3,"file":"portal-vue.umd.dev.js","sources":["../src/composables/wormhole.ts","../src/utils/index.ts","../src/components/portal.ts","../src/components/portal-target.ts","../src/wormhole.ts","../src/utils/mountPortalTarget.ts","../src/index.ts"],"sourcesContent":["import { type InjectionKey, inject, provide } from 'vue'\nimport type { Wormhole } from '../types'\n\nexport const wormholeSymbol = Symbol('wormhole') as InjectionKey<Wormhole>\n\nexport function useWormhole() {\n  const wh = inject(wormholeSymbol)\n\n  if (!wh) {\n    throw new Error(`\n    [portal-vue]: Necessary Injection not found. Make sur you installed the plugin properly.`)\n  }\n\n  return wh\n}\n\nexport function provideWormhole(wormhole: Wormhole) {\n  provide(wormholeSymbol, wormhole)\n}\n","import { watch } from 'vue'\n\nexport const inBrowser = typeof window !== 'undefined'\n\nexport const __DEV__ = __NODE_ENV__ === 'development'\n\nexport function warn(msg: string) {\n  console.log('[portal-vue]: ' + msg)\n}\n\nexport function assertStaticProps(\n  component: string,\n  props: Record<string, any>,\n  propNames: string[]\n) {\n  propNames.forEach(\n    (name) => {\n      watch(\n        () => props[name],\n        () => {\n          warn(\n            `Prop '${name}' of component ${component} is static, but was dynamically changed by the parent.\n          This change will not have any effect.`\n          )\n        }\n      )\n    },\n    { flush: 'post' }\n  )\n}\n\nexport function stableSort<T>(array: T[], compareFn: Function) {\n  return array\n    .map((v: T, idx: number) => {\n      return [idx, v] as [number, T]\n    })\n    .sort(function (a, b) {\n      return compareFn(a[1], b[1]) || a[0] - b[0]\n    })\n    .map((c) => c[1])\n}\n","import {\n  type Slots,\n  defineComponent,\n  onBeforeUnmount,\n  onMounted,\n  onUpdated,\n  watch,\n} from 'vue'\nimport { useWormhole } from '../composables/wormhole'\nimport type { Name, PortalProps } from '../types'\nimport { __DEV__, assertStaticProps, inBrowser } from '../utils'\n\nexport function usePortal(props: PortalProps, slots: Slots) {\n  const wormhole = useWormhole()\n\n  function sendUpdate() {\n    if (!inBrowser) return\n    const { to, name: from, order } = props\n    if (slots.default) {\n      wormhole.open({\n        to,\n        from: from!,\n        order,\n        content: slots.default,\n      })\n    } else {\n      clear()\n    }\n  }\n\n  function clear(target?: Name) {\n    wormhole.close({\n      to: target ?? props.to,\n      from: props.name,\n    })\n  }\n  onMounted(() => {\n    if (!props.disabled) {\n      sendUpdate()\n    }\n  })\n\n  onUpdated(() => {\n    if (props.disabled) {\n      clear()\n    } else {\n      sendUpdate()\n    }\n  })\n\n  onBeforeUnmount(() => {\n    clear()\n  })\n\n  watch(\n    () => props.to,\n    (newTo, oldTo) => {\n      if (props.disabled) return\n      if (oldTo && oldTo !== newTo) {\n        clear(oldTo)\n      }\n      sendUpdate()\n    }\n  )\n}\n\nexport default defineComponent({\n  compatConfig: { MODE: 3 },\n  name: 'portal',\n  props: {\n    disabled: { type: Boolean },\n    name: { type: [String, Symbol], default: () => Symbol() },\n    order: { type: Number },\n    slotProps: { type: Object, default: () => ({}) },\n    to: {\n      type: String,\n      default: () => String(Math.round(Math.random() * 10000000)),\n    },\n  },\n  setup(props, { slots }) {\n    __DEV__ && assertStaticProps('Portal', props, ['order', 'name'])\n    usePortal(props, slots)\n\n    return () => {\n      if (props.disabled && slots.default) {\n        return slots.default(props.slotProps)\n      } else {\n        return null\n      }\n    }\n  },\n})\n","import {\n  type FunctionalComponent,\n  type VNode,\n  computed,\n  defineComponent,\n  h,\n  watch,\n} from 'vue'\nimport { useWormhole } from '../composables/wormhole'\n\nconst PortalTargetContent: FunctionalComponent = (_, { slots }) => {\n  return slots.default?.()\n}\n\nexport default defineComponent({\n  compatConfig: { MODE: 3 },\n  name: 'portalTarget',\n  props: {\n    multiple: { type: Boolean, default: false },\n    name: { type: String, required: true },\n    slotProps: { type: Object, default: () => ({}) },\n  },\n  emits: ['change'],\n  setup(props, { emit, slots }) {\n    const wormhole = useWormhole()\n\n    const slotVnodes = computed<{ vnodes: VNode[]; vnodesFn: () => VNode[] }>(\n      () => {\n        const transports = wormhole.getContentForTarget(\n          props.name,\n          props.multiple\n        )\n        const wrapperSlot = slots.wrapper\n        const rawNodes = transports.map((t) => t.content(props.slotProps))\n        const vnodes = wrapperSlot\n          ? rawNodes.flatMap((nodes) =>\n              nodes.length ? wrapperSlot(nodes) : []\n            )\n          : rawNodes.flat(1)\n        return {\n          vnodes,\n          vnodesFn: () => vnodes, // just to make Vue happy. raw vnodes in a slot give a DEV warning\n        }\n      }\n    )\n\n    watch(\n      slotVnodes,\n      ({ vnodes }) => {\n        const hasContent = vnodes.length > 0\n        const content = wormhole.transports.get(props.name)\n        const sources = content ? [...content.keys()] : []\n        emit('change', { hasContent, sources })\n      },\n      { flush: 'post' }\n    )\n    return () => {\n      const hasContent = !!slotVnodes.value.vnodes.length\n      if (hasContent) {\n        return [\n          // this node is a necessary hack to force Vue to change the scoped-styles boundary\n          // TODO:  find less hacky solution\n          h('div', {\n            style: 'display: none',\n            key: '__portal-vue-hacky-scoped-slot-repair__',\n          }),\n          // we wrap the slot content in a functional component\n          // so that transitions in the slot can properly determine first render\n          // for `appear` behavior to work properly\n          h(PortalTargetContent, slotVnodes.value.vnodesFn),\n        ]\n      } else {\n        return slots.default?.()\n      }\n    }\n  },\n})\n","import { reactive, readonly } from 'vue'\nimport type {\n  Name,\n  Transport,\n  TransportCloser,\n  TransportInput,\n  TransportsHub,\n  Wormhole,\n} from './types'\nimport { inBrowser, stableSort } from './utils'\n\nexport function createWormhole(asReadonly = true): Wormhole {\n  const transports: TransportsHub = reactive(new Map())\n\n  function open(transport: TransportInput) {\n    if (!inBrowser) return\n\n    const { to, from, content, order = Infinity } = transport\n    if (!to || !from || !content) return\n\n    if (!transports.has(to)) {\n      transports.set(to, new Map())\n    }\n    const transportsForTarget = transports.get(to)!\n\n    const newTransport = {\n      to,\n      from,\n      content,\n      order,\n    } as Transport\n\n    transportsForTarget.set(from, newTransport)\n  }\n\n  function close(transport: TransportCloser) {\n    const { to, from } = transport\n    if (!to || !from) return\n    const transportsForTarget = transports.get(to)\n    if (!transportsForTarget) {\n      return\n    }\n    transportsForTarget.delete(from)\n    if (!transportsForTarget.size) {\n      transports.delete(to)\n    }\n  }\n\n  function getContentForTarget(target: Name, returnAll?: boolean) {\n    const transportsForTarget = transports.get(target)\n    if (!transportsForTarget) return []\n\n    const content = Array.from(transportsForTarget?.values() || [])\n\n    if (!returnAll) {\n      // return Transport that was added last\n      return [content.pop()] as Transport[]\n    }\n    // return all Transports, sorted by their order property\n    return stableSort(\n      content,\n      (a: Transport, b: Transport) => a.order - b.order\n    )\n  }\n\n  const wh: Wormhole = {\n    open,\n    close,\n    transports,\n    getContentForTarget,\n  }\n  return asReadonly ? (readonly(wh) as Wormhole) : wh\n}\n\nexport const wormhole = createWormhole()\n","import type { PortalTargetProps } from '../types'\nimport {\n  type ComponentInternalInstance,\n  createApp,\n  getCurrentInstance,\n  h,\n  onBeforeUnmount,\n  onMounted,\n} from 'vue'\nimport PortalTarget from '../components/portal-target'\n\nexport function mountPortalTarget(\n  targetProps: PortalTargetProps,\n  el: HTMLElement | string\n) {\n  const app = createApp({\n    // @ts-expect-error no idea why h() doesn't like this import\n    render: () => h(PortalTarget, targetProps),\n  })\n\n  if (!targetProps.multiple) {\n    // this is hacky as it relies on internals, but works.\n    // TODO: can we get rid of this by somehow properly replacing the target's .parent?\n    const provides =\n      (\n        getCurrentInstance() as ComponentInternalInstance & {\n          provides: Record<string, any>\n        }\n      ).provides ?? {}\n    app._context.provides = Object.create(provides)\n    //Object.assign(app._context.provides, Object.create(provides))\n  }\n  onMounted(() => {\n    app.mount(el)\n  })\n  onBeforeUnmount(() => {\n    app.unmount()\n  })\n}\n","import type { App } from 'vue'\nimport Portal from './components/portal'\nimport PortalTarget from './components/portal-target'\nimport {\n  provideWormhole,\n  useWormhole,\n  wormholeSymbol,\n} from './composables/wormhole'\nimport type { Wormhole as TWormhole } from './types'\nimport { createWormhole, wormhole as defaultWormhole } from './wormhole'\nexport { mountPortalTarget } from './utils/mountPortalTarget'\nexport interface PluginOptions {\n  portalName?: string | false\n  portalTargetName?: string | false\n  MountingPortalName?: string\n  wormhole?: TWormhole\n}\n\nexport default function install(app: App, options: PluginOptions = {}) {\n  options.portalName !== false &&\n    app.component(options.portalName || 'Portal', Portal)\n  options.portalTargetName !== false &&\n    app.component(options.portalTargetName || 'PortalTarget', PortalTarget)\n\n  const wormhole = options.wormhole ?? defaultWormhole\n  app.provide(wormholeSymbol, wormhole)\n}\n\nexport const Wormhole = defaultWormhole\n\nexport const version = __PORTAL_VUE_VERSION__\n\nexport {\n  install,\n  Portal,\n  PortalTarget,\n  useWormhole,\n  provideWormhole,\n  TWormhole,\n  createWormhole,\n}\n"],"names":["inject","wormhole","provide","watch","onMounted","onUpdated","onBeforeUnmount","defineComponent","computed","h","reactive","readonly","createApp","getCurrentInstance","defaultWormhole"],"mappings":"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"}